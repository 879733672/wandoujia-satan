<section class="wdj-messages">
    <section class="wdm-sub">
        <section class="wdm-actions">
            <div class="btn btn-primary"
                ng-click="createConversation()"><i class="messages-icon-ab-add"></i> {{$root.DICT.messages.ACTION_NEW}}</div>
            <div class="btn"
                ng-click="toggleSelectedAll()"
                ng-switch on="isSelectedAll()">
                <i class="messages-icon-ab-sel"></i>
                <span ng-switch-when="false">{{$root.DICT.messages.ACTION_SELECT_ALL}}</span>
                <span ng-switch-when="true">{{$root.DICT.messages.ACTION_DESELECT_ALL}}</span>
            </div>
            <div class="btn"
                ng-click="removeSelected()"
                ng-show="hasSelected()"><i class="messages-icon-ab-del"></i> {{$root.DICT.messages.ACTION_DELETE}}</div>
        </section>
        <ol class="wdm-conversations unstyled">
            <li class="wdmc-row"
                ng-repeat="c in conversations"
                ng-init="status=cvsCache.get(c)"
                ng-class="{ selected: status.selected, highlight: status.active }"
                wdm-conversation>
                <label class="wdmcr-a">
                    <input type="checkbox" ng-model="status.selected">
                </label>
                <div class="wdmcr-b" ng-class="{ multiple: c.addresses.length > 1 }">
                    <img ng-show="c.photo_path" ng-src="{{c.photo_path}}">
                </div>
                <div class="wdmcr-c">
                    <div class="wdmcr-c-a">{{ status.displayName() }}</div>
                    <div class="wdmcr-c-b">{{ c.snippet }}</div>
                </div>
                <div class="wdmcr-d">
                    <div class="status">&nbsp;
                        <i ng-show="c.has_error || hasFailedMsg(c)" class="wdmcr-icon-alert"></i>
                        <i ng-show="hasPendingMsg(c)" class="wdmcr-icon-running"></i>
                        <span class="badge" ng-show="c.unread_message_count">{{ c.unread_message_count }}</span>
                    </div>
                    <div>
                        {{ status.date() | messageDate:'MMM d' }}
                    </div>
                </div>
            </li>
            <li wdm-load-more="prevConversations()" ng-hide="cvsLoaded"></li>
        </ol>
    </section>
    <section class="wdm-main">
        <section class="wdm-contact">
            <div class="wdmct-a">{{ cvsCache.get(activeConversation).displayName() }}</div>
            <div class="wdmct-b" ng-show="activeConversation.addresses.length > 1"><i class="messages-icon-contact"></i></div>
        </section>
        <section class="wdm-entries" wdm-auto-scroll="cvsCache.get(activeConversation).messages">
            <div>
                <div wdm-load-more="prevMessages(activeConversation)" ng-hide="cvsCache.get(activeConversation).loaded"></div>
                <div ng-repeat="(d, g) in cvsCache.get(activeConversation).groups">
                    <div class="wdme-row"
                        ng-class="{'wdme-row-self': m.type >= 2 && m.type <= 5}"
                        ng-repeat="m in g">
                        <div class="wdmer-a">{{ m.body }}</div>
                        <div class="wdmer-b" ng-switch on="m.status">
                            <span ng-switch-when="64"><i class="messages-icon-alert"></i> Send Failed. <a href="" ng-click="resendMessage(m)">Retry</a></span>
                            <i ng-switch-when="32" class="messages-icon-running"></i>
                            <span class="wdmer-b-date" ng-switch-default>{{ m.date | messageDate:'HH:mm' }}</span>
                            <a href="" class="wdmer-b-del" ng-click="removeMessage(activeConversation, m)"><i class="messages-icon-ab-del"></i></a>
                        </div>
                    </div>
                    <div class="wdme-sep" ng-show="!$last">
                        <span>{{ d | messageDate:'MMM d' }}</span>
                    </div>
                </div>
            </div>
        </section>
        <section class="wdm-editor">
            <form ng-submit="sendMessage(activeConversation, sms)">
                <input type="text" placeholder="{{ cvsCache.get(activeConversation).editorPlaceholder() }}" ng-model="sms" ng-disabled="!editorEnable">
                <button class="btn" type="submit"
                    ng-disabled="!editorEnable"
                    ng-switch on="editorEnable">
                    <span ng-switch-when="true">{{$root.DICT.messages.EDITOR_SUBMIT}}</span>
                    <span ng-switch-when="false" class="wd-loading wd-loading-inline" data-visible="true"></span>
                </button>
            </form>
        </section>
        <div class="wd-loading" data-visible="cvsChanging"></div>
    </section>
</section>
