<section class="wdj-messages">
    <section class="wdm-sub">
        <section class="wdm-actions">
            <div class="btn btn-primary"
                ng-click="createConversation()"><i class="messages-icon-ab-add"></i> New message</div>
            <div class="btn"
                ng-click="toggleSelectedAll()"
                ng-switch on="isSelectedAll()">
                <i class="messages-icon-ab-sel"></i>
                <span ng-switch-when="false">Select all</span>
                <span ng-switch-when="true">Deselect all</span>
            </div>
            <div class="btn"
                ng-click="removeSelected()"
                ng-show="hasSelected()"><i class="messages-icon-ab-del"></i> Delete</div>
        </section>
        <ol class="wdm-conversations unstyled">
            <li class="wdmc-row"
                ng-repeat="c in conversations"
                ng-init="status=cvsCache.get(c)"
                ng-class="{ selected: status.selected, highlight: status.active }"
                ng-click="showConversation(c)">
                <label class="wdmcr-a">
                    <input type="checkbox" ng-model="status.selected">
                </label>
                <div class="wdmcr-b" ng-class="{ multiple: c.addresses.length > 1 }">
                    <img ng-show="c.photo_path" ng-src="{{c.photo_path}}">
                </div>
                <div class="wdmcr-c">
                    <div class="wdmcr-c-a">{{ status.displayName() }}</div>
                    <div class="wdmcr-c-b">{{ c.snippet }}</div>
                </div>
                <div class="wdmcr-d">
                    <div class="status">
                        <i ng-show="c.has_error || hasFailedMsg(c)" class="wdmcr-icon-alert"></i>
                        <i ng-show="hasPendingMsg(c)" class="wdmcr-icon-running"></i>
                        <span class="badge" ng-show="c.unread_message_count">{{ c.unread_message_count }}</span>
                    </div>
                    <div>
                        {{ status.date() | messageDate:'MMM d' }}
                    </div>
                </div>
            </li>
            <li wdm-load-more="prevConversations()"></li>
        </ol>
    </section>
    <section class="wdm-main">
        <section class="wdm-contact">
            <div class="wdmct-a">{{ cvsCache.get(activeConversation).displayName() }}</div>
            <div class="wdmct-b"><i class="messages-icon-contact"></i></div>
        </section>
        <section class="wdm-entries" wdm-auto-scroll="cvsCache.get(activeConversation).messages">
            <ol class="unstyled">
                <li wdm-load-more="prevMessages(activeConversation)" ng-hide="cvsCache.get(activeConversation).loaded"></li>
                <li class="wdme-row"
                    ng-class="{'wdme-row-self': m.type >= 2 && m.type <= 5}"
                    ng-repeat="m in cvsCache.get(activeConversation, 'messages') | orderBy:'date'">
                    <div class="wdmer-a">{{ m.body }}</div>
                    <div class="wdmer-b" ng-switch on="m.status">
                        <span ng-switch-when="64"><i class="messages-icon-alert"></i> Send Failed. <a href="">Retry</a></span>
                        <i ng-switch-when="32" class="messages-icon-running"></i>
                        <span ng-switch-default>{{ m.date | messageDate:'HH:mm' }}</span>
                    </div>
                </li>
            </ol>
        </section>
        <section class="wdm-editor" ng-init="sms">
            <form ng-submit="sendMessage(activeConversation, sms);sms=''">
                <input type="text" placeholder="Reply to {{ cvsCache.get(activeConversation).displayName() }}" ng-model="sms">
                <button class="btn" type="submit">Send</button>
            </form>
        </section>
        <div class="wd-loading" data-visible="cvsChanging"></div>
    </section>
</section>
